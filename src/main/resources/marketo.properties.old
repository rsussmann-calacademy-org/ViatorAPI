marketo.marketoEndpoint     =https://945-SMH-086.mktoapi.com/soap/mktows/2_2?WSDL
marketo.marketoUserId       =californiaacademyofsciences1_1297519852CC396BBAAC41
marketo.marketoSecretKey    =96207525314004195522CCCC339966CDBBAABC737343
marketo.marketoQnameUrl     =http://www.marketo.com/mktows/
marketo.marketoQnameName    =MktMktowsApiService
marketo.marketoProgramName  =TechnicalTest
marketo.marketoCampaignName =TechnicalTestCampaign
marketo.marketoListName     =Trav-Test-List

marketo.dataSourceDriver    =net.sourceforge.jtds.jdbc.Driver
marketo.dataSourceUrl       =jdbc:jtds:sqlserver://warehouse-prod:1433/AcademyContacts
marketo.dataSourceUser      =Jasper
marketo.dataSourcePassword  =J@sp3r4321

marketo.sql        =select a.id, a.lastName, a.firstName, '' as job, '' as company, a.email, b.name as source, \
                                c.name as status, e.name as subscriptions             \
                                from contacts a                                                         \
                                inner join sources b on a.sourceId = b.id                               \
                                inner join status c on a.statusId = c.id                                \
                                inner join ContactsSubscriptions d on a.id = d.contactId                \
                                inner join subscriptions e on e.id = d.subscriptionId                   \
                                where a.lastUploaded is null        \
                             order by a.email
marketo.batchRows           =20000
marketo.columnNames         =Last Name,First Name,Job Title,Company Name,Email Address
marketo.columnIndices       =2,3,4,5,6
marketo.columnListName      =subscriptions
marketo.columnProgramName   =
marketo.columnCampaignName  =
marketo.columnLastUploaded  =lastUploaded
marketo.useSqlColumnNames   =false

marketo.syncMultipleLeads.marketoEndpoint=https://945-SMH-086.mktoapi.com/soap/mktows/2_2?WSDL
marketo.syncMultipleLeads.columnEmail=Email
marketo.syncMultipleLeads.sqlOriginal=\
  select a.lastName as LastName, a.firstName as FirstName, '' as Job, '' as Company, b.name as Source, c.name as Status, a.email as Email \
    \
  from contacts a                                                           \
  inner join sources b on a.sourceId = b.id                                 \
  inner join status c on a.statusId = c.id                                  \
  inner join ContactsSubscriptions d on a.id = d.contactId                  \
  inner join subscriptions e on e.id = d.subscriptionId                     \
  where a.lastUploaded = '1970-01-01' and a.lastName is not null and a.firstName is not null and b.name is not null and c.name is not null \
  order by a.email
marketo.syncMultipleLeadsDesired.sql=\
  select a.id, a.lastName as LastName, a.firstName as FirstName, a.email as Email,title as Salutation, jobTitle as Title, company as Company, c.name as Status,   \
    b.name as LeadSource, a.RaiserEdgeId, a.galaxyId as GalaxyId, \
    a.PostalCode, a.phone as Phone, a.city as City, a.State, a.Country, a.Birthdate as DateOfBirth, a.Gender as MarketoSocialGender, a.School \
    from contacts a \
    inner join sources b on a.sourceId = b.id \
    left outer join status c on c.id=a.statusId \
  where a.lastUploaded = '1970-01-01' \
  order by a.email
marketo.syncMultipleLeadsWorking.sql=\
  select a.lastName as LastName, a.firstName as FirstName, a.email as Email   \
    from contacts a \
    inner join sources b on a.sourceId = b.id \
    left outer join status c on c.id=a.statusId \
  where a.lastUploaded = '1970-01-01' \
  order by a.email
line2=  c.id as Status, a.PostalCode, a.phone as Phone, a.city as City, a.State, a.Country, a.Birthdate as DateOfBirth, a.School
marketo.syncMultipleLeadsReal.sql=\
  select a.lastName as LastName, a.firstName as FirstName, a.email as Email,title as Salutation, jobTitle as Title, company as Company, \
  c.id as Status, a.PostalCode, a.phone as Phone,  a.city as City, a.State, a.Country, a.School, a.Birthdate as DateOfBirth \
    from contacts a \
    inner join sources b on a.sourceId = b.id \
    left outer join status c on c.id=a.statusId \
  where a.lastUploaded = '1970-01-01' \
  order by a.email
marketo.syncMultipleLeads.sql=\
    select a.lastName as LastName, a.firstName as FirstName, a.email as Email,title as Salutation, jobTitle as Title, company as Company, \
    c.name as Status, a.zip as PostalCode, a.phone as Phone,  a.city as City, a.State, a.Country, a.School, a.Birthdate as DateOfBirth, \
     CASE when c.name = 'active' THEN 'true' ELSE 'false' END as Unsubscribed \
      from contacts a  \
      left outer join status c on c.id=a.statusId \
    where a.worker = ?

marketo.syncMultipleLeads.sqlBefore=\
  update contacts set lastUploaded = '1970-01-01', worker = ? where id in (select top 100 id from contacts where worker is null and lastUploaded is null)
marketo.syncMultipleLeads.sqlBeforeSingle=\
  update contacts set lastUploaded = '1970-01-01', worker = ? where id = ?

part2=and email not in (select key1 from MarketoStatus where objectType = 'Lead' and status IN ('CREATED', 'UPDATED'))
marketo.syncMultipleLeads.sqlAfterSuccess=\
  update contacts set lastUploaded = GETDATE(), worker = null where worker = ?
marketo.syncMultipleLeads.sqlAfterFailure=\
  update contacts set lastUploaded = null, worker = null where worker = ?
marketo.syncMultipleLeads.sqlInsertStatus=\
  insert into MarketoStatus (objectType, status, error, key1, key2, lastUpdated) values (?, ?, ?, ?, ?, getdate())


marketo.syncVisitations.marketoEndpoint     =https://945-SMH-086.mktoapi.com/soap/mktows/2_2?WSDL
marketo.syncVisitations.marketoUserId       =californiaacademyofsciences1_1297519852CC396BBAAC41
marketo.syncVisitations.marketoSecretKey    =96207525314004195522CCCC339966CDBBAABC737343
marketo.syncVisitations.marketoQnameUrl     =http://www.marketo.com/mktows/
marketo.syncVisitations.marketoQnameName    =MktMktowsApiService
marketo.syncVisitations.keys=EmailAddress,VisualID
marketo.syncVisitations.sqlBefore=\
  update contacts set luVisitations = '1970-01-01' where email in (\
  select top 100 email from GalaxyScans WHERE email IN (select key1 FROM MarketoStatus where objectType = 'Lead' and status IN ('CREATED', 'UPDATED')) \
    and Email not in (select key1 from MarketoStatus where objectType = 'Visitation' and status in ('CREATED', 'UPDATED')) order by email \
  )
marketo.syncVisitations.attributes=Quantity,VisitDate,VisitType,AccessCodeGroup
marketo.syncVisitations.sqlPrevious=select email as EmailAddress, visualID as VisualID, accessCodeGroupId as AccessCodeGroup, null as VisitType, usetime as VisitDate, qty as Quantity \
  from GalaxyScans WHERE email IN (select email FROM contacts where luVisitations = '1970-01-01' and lastUploaded is not null)
marketo.syncVisitations.sql=select top 100 email as EmailAddress, visualID as VisualID, accessCodeGroupId as AccessCodeGroup, null as VisitType, usetime as VisitDate, qty as Quantity \
                              from GalaxyScans WHERE email IN (select key1 FROM MarketoStatus where objectType = 'Lead' and status IN ('CREATED', 'UPDATED')) \
                              and Email not in (select key1 from MarketoStatus where objectType = 'Visitation' and status in ('CREATED', 'UPDATED')) order by email
marketo.syncVisitations.sqlAfterSuccess=\
  update contacts set luVisitations = GETDATE() where luVisitations = '1970-01-01'
marketo.syncVisitations.sqlAfterFailure=\
  update contacts set luVisitations = null where luVisitations = '1970-01-01'
marketo.syncVisitations.marketoKeys=EmailAddress,VisualID
marketo.syncVisitations.sqlInsertStatus=\
  insert into MarketoStatus (objectType, status, error, key1, key2, lastUpdated) values (?, ?, ?, ?, ?, getdate())
marketo.syncVisitations.sqlWorkerBefore=\
  update contacts set worker = ? where email in \
  (\
    select top 100 a.email \
      FROM GalaxyScans a INNER JOIN contacts b on a.email = b.email \
      LEFT JOIN MarketoStatus c ON a.email = c.key1 AND c.objectType = 'Lead' \
      LEFT JOIN MarketoStatus d on a.email = d.key1 AND d.objectType = 'Visitation' \
      WHERE a.email is not null and LEN(a.email) > 0 and b.worker IS NULL \
      and c.key1 IS NOT NULL AND d.key1 IS NULL \
  )
marketo.syncVisitations.sqlWorker=select a.email as EmailAddress, visualID as VisualID, accessCodeGroupId as AccessCodeGroup, null as VisitType, usetime as VisitDate, qty as Quantity \
    from GalaxyScans a INNER JOIN contacts b ON a.email = b.email WHERE b.worker = ? order by a.email
marketo.syncVisitations.sqlWorkerAfterSuccess=\
  update contacts set worker = null, luVisitations = getdate() where worker = ?
marketo.syncVisitations.sqlWorkerAfterFailure=\
  update contacts set worker = null where worker = ?
marketo.syncVisitations.sqlCountRecordsToProcess=\
  select count(distinct a.email) from GalaxyScans a \
  INNER JOIN MarketoStatus c on c.objectType = 'Lead' AND a.email = c.key1 \
  LEFT JOIN MarketoStatus b on a.email = b.key1 AND b.objectType = 'Visitation' \
  WHERE b.key1 IS NULL AND a.email IS NOT NULL AND a.email <> ''




marketo.syncConstituents.marketoEndpoint=https://945-SMH-086.mktoapi.com/soap/mktows/2_2?WSDL
marketo.syncConstituents.marketoUserId       =californiaacademyofsciences1_1297519852CC396BBAAC41
marketo.syncConstituents.marketoSecretKey    =96207525314004195522CCCC339966CDBBAABC737343
marketo.syncConstituents.marketoQnameUrl     =http://www.marketo.com/mktows/
marketo.syncConstituents.marketoQnameName    =MktMktowsApiService
marketo.syncConstituents.keys=ConstituentEmailAddress,EmailAddress
marketo.syncConstituents.attributes=ConstituentID, VisualID, MembershipProgram,\
    MembershipStanding, ExpirationDate,TimesRenewed, JoinDate, DropDate, WeathScoreCategory,\
    WeathScore, LastGiftAmount, HighestGiftAmount, LastGiftDate, LastGiftFundDescription, TotalGiftAmount
marketo.syncConstituents.sqlBefore=\
  update contacts set luConstituents= '1970-01-01' where email in (\
        select top 100 ConstituentEmailAddress FROM constituents WHERE ConstituentEmailAddress IN \
  (select key1 FROM MarketoStatus where objectType = 'Lead' and status IN ('CREATED', 'UPDATED'))  \
        AND ConstituentEmailAddress NOT IN \
  (select key1 from MarketoStatus where objectType = 'Constituent' and status in ('CREATED', 'UPDATED')) order by constituentEmailAddress \
  )
marketo.syncConstituents.sqlWorkerBefore=\
  update contacts set worker = ? where email in (\
        select top 100 a.constituentEmailAddress \
          FROM constituents a INNER JOIN contacts b on a.constituentEmailAddress = b.email \
          LEFT JOIN MarketoStatus c ON a.constituentEmailAddress = c.key1 AND c.objectType = 'Lead' \
          LEFT JOIN MarketoStatus d on a.constituentEmailAddress = d.key1 AND d.objectType = 'Constituent' \
          WHERE a.constituentEmailAddress is not null and LEN(a.constituentEmailAddress) > 0 and b.worker IS NULL \
          and c.key1 IS NOT NULL AND d.key1 IS NULL \
    )
marketo.syncConstituents.sqlWorker=select ConstituentEmailAddress, ConstituentEmailAddress as EmailAddress, ConstituentID, VisualID, MembershipLevel as MembershipProgram, \
    MembershipLevel, MembershipStanding, ExpirationDate,TimesRenewed, JoinDate, DropDate, WeathScoreCategory, \
    WeathScore, LastGiftAmount, HighestGiftAmount, LastGiftDate, LastGiftFundDescription, TotalGiftAmount  \
    FROM constituents a INNER JOIN contacts b ON a.constituentEmailAddress = b.email WHERE b.worker = ? order by constituentEmailAddress
marketo.syncConstituents.sqlWorkerAfterSuccess=\
  update contacts set worker = null, luConstituents = getdate() where worker = ?
marketo.syncConstituents.sqlWorkerAfterFailure=\
  update contacts set worker = null where worker = ?

marketo.syncConstituents.sqlPrevious=select	ConstituentEmailAddress, ConstituentEmailAddress as EmailAddress, ConstituentID, VisualID, MembershipProgram,\
   MembershipLevel, MembershipStanding, ExpirationDate,TimesRenewed, JoinDate, DropDate, WeathScoreCategory,\
  WeathScore, LastGiftAmount, HighestGiftAmount, LastGiftDate, LastGiftFundDescription, TotalGiftAmount \
  FROM constituents WHERE ConstituentEmailAddress IN (select email FROM contacts where \
  luConstituents = '1970-01-01' and lastUploaded > '1970-01-01')
marketo.syncConstituents.sql=select top 100 ConstituentEmailAddress, ConstituentEmailAddress as EmailAddress, ConstituentID, VisualID, MembershipLevel as MembershipProgram, \
    MembershipLevel, MembershipStanding, ExpirationDate,TimesRenewed, JoinDate, DropDate,  WeathScoreCategory, \
    WeathScore, LastGiftAmount, HighestGiftAmount, LastGiftDate, LastGiftFundDescription, TotalGiftAmount  \
    FROM constituents WHERE ConstituentEmailAddress IN \
  (select key1 FROM MarketoStatus where objectType = 'Lead' and status IN ('CREATED', 'UPDATED'))  \
    AND ConstituentEmailAddress NOT IN \
  (select key1 from MarketoStatus where objectType = 'Constituent' and status in ('CREATED', 'UPDATED')) order by constituentEmailAddress

marketo.syncConstituents.sqlAfterSuccess=\
  update contacts set luConstituents = GETDATE() where luConstituents = '1970-01-01'
marketo.syncConstituents.sqlAfterFailure=\
  update contacts set luConstituents = null where luConstituents = '1970-01-01'
marketo.syncConstituents.marketoKeys=EmailAddress,ConstituentEmailAddress
marketo.syncConstituents.sqlInsertStatus=\
  insert into MarketoStatus (objectType, status, error, key1, key2, lastUpdated) values (?, ?, ?, ?, ?, getdate())
marketo.syncConstituents.sqlCountRecordsToProcess=\
  select count(distinct a.constituentEmailAddress) from constituents a \
  INNER JOIN MarketoStatus cå on c.objectType = 'Lead' AND a.constituentEmailAddress = c.key1 \
  LEFT JOIN MarketoStatus b on a.constituentEmailAddress = b.key1 AND b.objectType = 'Constituent' WHERE b.key1 IS NULL \
  AND a.constituentEmailAddress IS NOT NULL AND a.constituentEmailAddress <> ''


marketo.syncInterests.marketoEndpoint     =https://945-SMH-086.mktoapi.com/soap/mktows/2_2?WSDL
marketo.syncInterests.marketoUserId       =californiaacademyofsciences1_1297519852CC396BBAAC41
marketo.syncInterests.marketoSecretKey    =96207525314004195522CCCC339966CDBBAABC737343
marketo.syncInterests.marketoQnameUrl     =http://www.marketo.com/mktows/
marketo.syncInterests.marketoQnameName    =MktMktowsApiService
marketo.syncInterests.keys=EmailAddress,InterestName
marketo.syncInterests.sqlBefore=\
  update contacts set luInterests = '1970-01-01' where email in (\
  select top 100 a.email from contacts a INNER JOIN contactsInterests b ON a.contactId = b.contactId WHERE a.email IN (select key1 FROM MarketoStatus where objectType = 'Lead' and status IN ('CREATED', 'UPDATED')) \
    and Email not in (select key1 from MarketoStatus where objectType = 'Interest_In' and status in ('CREATED', 'UPDATED')) \
  )
marketo.syncInterests.attributes=
marketo.syncInterests.sql=select top 100 email as EmailAddress, code as InterestName FROM contacts a INNER JOIN contactsInterests b ON a.contactId = b.contactId WHERE \
                              email IN (select key1 FROM MarketoStatus where objectType = 'Lead' and status IN ('CREATED', 'UPDATED')) \
                              and Email not in (select key1 from MarketoStatus where objectType = 'Interest_In' and status in ('CREATED', 'UPDATED'))
marketo.syncInterests.sqlAfterSuccess=\
  update contacts set luInterests = GETDATE() where luInterests = '1970-01-01'
marketo.syncInterests.sqlAfterFailure=\
  update contacts set luInterests = null where luInterests = '1970-01-01'
marketo.syncInterests.marketoKeys=EmailAddress,InterestName
marketo.syncInterests.sqlInsertStatus=\
  insert into MarketoStatus (objectType, status, error, key1, key2, lastUpdated) values (?, ?, ?, ?, ?, getdate())
marketo.syncInterests.sqlWorkerBefore=\
  update contacts set worker = ? where email in \
  (\
    select top 100 a.email \
      FROM contacts a INNER JOIN contactsInterests b ON a.id = b.contactId \
      INNER JOIN MarketoStatus c ON a.email = c.key1 AND c.objectType = 'Lead' \
      LEFT JOIN MarketoStatus d on a.email = d.key1 AND d.objectType = 'Interest_In' \
      WHERE a.email is not null and LEN(a.email) > 0 and a.worker IS NULL \
      AND d.key1 IS NULL \
  )
marketo.syncInterests.sqlWorker=select a.email as EmailAddress, c.code as InterestName \
    from contacts a INNER JOIN contactsInterests b ON a.id = b.contactId INNER JOIN interests c ON b.interestid = c.id WHERE a.worker = ?
marketo.syncInterests.sqlWorkerAfterSuccess=\
  update contacts set worker = null, luInterests = getdate() where worker = ?
marketo.syncInterests.sqlWorkerAfterFailure=\
  update contacts set worker = null where worker = ?
marketo.syncInterests.sqlCountRecordsToProcess=\
  select count(*) from contacts a INNER JOIN ContactsInterests b on a.id = b.contactId INNER JOIN Interests c on b.interestId = c.id \
  INNER JOIN MarketoStatus e on a.email = e.key1 AND e.objectType = 'Lead' \
  LEFT JOIN MarketoStatus d ON a.email = d.key1 AND c.code = d.key2 AND d.objectType = 'Interest_In' \
  WHERE d.key1 IS NULL AND a.email IS NOT NULL and a.email <> ''


marketo.syncOrders.marketoEndpoint=https://945-SMH-086.mktoapi.com/soap/mktows/2_2?WSDL
marketo.syncOrders.marketoUserId       =californiaacademyofsciences1_1297519852CC396BBAAC41
marketo.syncOrders.marketoSecretKey    =96207525314004195522CCCC339966CDBBAABC737343
marketo.syncOrders.marketoQnameUrl     =http://www.marketo.com/mktows/
marketo.syncOrders.marketoQnameName    =MktMktowsApiService
marketo.syncOrders.keys=EmailAddress,OrderID
marketo.syncOrders.marketoKeys=EmailAddress,OrderID
marketo.syncOrders.attributes=Agency,DiscountName,OrderDate,OrderTotal,OrderSubtotal,OrderTax,OrderTotal
marketo.syncOrders.sqlInsertStatus=\
  insert into MarketoStatus (objectType, status, error, key1, key2, lastUpdated) values (?, ?, ?, ?, ?, getdate())
marketo.syncOrders.sqlWorkerBefore=\
  update contacts set worker = ? where email in \
  (\
      select top 100 a.email \
      FROM GalaxyOrders a INNER JOIN contacts b on a.email = b.email  \
      INNER JOIN MarketoStatus c ON a.email = c.key1 AND c.objectType = 'Lead'  \
      LEFT JOIN MarketoStatus d on a.email = d.key1 AND d.objectType = 'Order' \
      WHERE a.email is not null and LEN(a.email) > 0 and b.worker IS NULL \
      AND d.key1 IS NULL \
  )
marketo.syncOrders.sqlWorker=select a.email as EmailAddress, OrderID, [Purchase Date] as OrderDate, [Purchase Amount] as OrderTotal, \
   AgencyDescription as Agency,null as OrderSubtotal,null as OrderTax,null as DiscountName \
   from GalaxyOrders a INNER JOIN contacts b ON a.email = b.email WHERE b.worker = ?
marketo.syncOrders.sqlWorkerAfterSuccess=\
  update contacts set worker = null, luOrders = getdate() where worker = ?
marketo.syncOrders.sqlWorkerAfterFailure=\
  update contacts set worker = null where worker = ?
marketo.syncOrders.sqlCountRecordsToProcess=\
  select count(distinct a.email) from GalaxyOrders a \
  INNER JOIN MarketoStatus c on a.email = c.key1 AND objectType = 'Lead'\
  LEFT JOIN MarketoStatus b on a.email = b.key1 AND b.objectType = 'Order' \
  WHERE b.key1 IS NULL AND a.email IS NOT NULL AND a.email <> ''


marketo.syncOrderDetails.marketoEndpoint=https://945-SMH-086.mktoapi.com/soap/mktows/2_2?WSDL
marketo.syncOrderDetails.marketoUserId       =californiaacademyofsciences1_1297519852CC396BBAAC41
marketo.syncOrderDetails.marketoSecretKey    =96207525314004195522CCCC339966CDBBAABC737343
marketo.syncOrderDetails.marketoQnameUrl     =http://www.marketo.com/mktows/
marketo.syncOrderDetails.marketoQnameName    =MktMktowsApiService
marketo.syncOrderDetails.keys=EmailAddress,OrderID,VisualID
marketo.syncOrderDetails.attributes=PLUName,PLUItemGroup,PLUPrice,DiscountName
marketo.syncOrderDetails.marketoKeys=EmailAddress,OrderID,VisualID
marketo.syncOrderDetails.sqlInsertStatus=\
  insert into MarketoStatus (objectType, status, error, key1, key2, lastUpdated) values (?, ?, ?, ?, ?, getdate())
marketo.syncOrderDetails.sqlWorkerBefore=\
  update contacts set worker = ? where email in \
  (\
      select top 100 a.EmailAddress \
      FROM OrderDetails a INNER JOIN contacts b on a.EmailAddress = b.email  \
      INNER JOIN MarketoStatus c ON a.email = c.key1 AND c.objectType = 'Lead'  \
      LEFT JOIN MarketoStatus d on a.email = d.key1 AND d.objectType = 'Order' \
      WHERE a.email is not null and LEN(a.email) > 0 and b.worker IS NULL \
      AND d.key1 IS NULL \
  )
marketo.syncOrderDetails.sqlWorker=\
  SELECT \
      EmailAddress, VisualID, OrderID, PLUPrice, PLUName, PLUItemGroup \
  FROM OrderDetails a \
  INNER JOIN contacts b on a.emailAddress = b.email WHERE b.worker = ?
marketo.syncOrderDetails.sqlWorkerAfterSuccess=\
  update contacts set worker = null, luOrderDetails = getdate() where worker = ?
marketo.syncOrderDetails.sqlWorkerAfterFailure=\
  update contacts set worker = null where worker = ?
marketo.syncOrderDetails.sqlCountRecordsToProcess=\
select count(distinct a.EmailAddress) from OrderDetails a \
  INNER JOIN MarketoStatus c ON a.EmailAddress = c.key1 AND c.objectType = 'Lead' \
LEFT JOIN MarketoStatus d on a.EmailAddress = d.key1 AND d.objectType = 'OrderDetail'  \
WHERE d.key1 IS NULL AND a.EmailAddress IS NOT NULL AND a.email <> ''
